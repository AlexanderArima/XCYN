$(function(){$.extend($.fn.validatebox.defaults.rules,{date:{validator:function(a,c){var b;b=a.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(null==b)b=!1;else{var d=new Date(b[1],b[3]-1,b[4]);b=d.getFullYear()==b[1]&&d.getMonth()+1==b[3]&&d.getDate()==b[4]}return b},message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u65e5\u671f"}});global={action:"",editable:void 0,search:function(){console.log($("#reg_from").datebox("getValue"));$("#table_users").datagrid("load",{user_name:$(".textbox[name\x3d'user_name']").val(),reg_from:$("#reg_from").datebox("getValue"),reg_to:$("#reg_to").datebox("getValue")})},add:function(){void 0==this.editable&&($("#table_users").datagrid("insertRow",{index:0,row:{user_name:"",reg_time:""}}),$("#table_users").datagrid("beginEdit",0),$("#button_save,#button_cancel").show(),$("#table_users").datagrid("selectRow",0),this.editable=0,this.action="add")},save:function(){$("#table_users").datagrid("endEdit",this.editable)},cancel:function(){$("#button_save,#button_cancel").hide();this.editable=void 0;$("#table_users").datagrid("rejectChanges")},update:function(){var a=$("#table_users").datagrid("getRows"),c=$("#table_users").datagrid("getRowIndex",$("#table_users").datagrid("getSelected"));if(-1<c){for(var b=0;b<a.length;b++)$("#table_users").datagrid("endEdit",$("#table_users").datagrid("getRowIndex",a[b]));$("#table_users").datagrid("beginEdit",c);$("#button_save,#button_cancel").show();this.editable=c;this.action="update"}else $.messager.alert("\u63d0\u793a","\u8bf7\u9009\u62e9\u4e00\u884c!","info")},"delete":function(){var a=$("#table_users").datagrid("getChecked");0<a.length?$.messager.confirm("\u786e\u8ba4\u64cd\u4f5c","\u60a8\u786e\u5b9a\u8981\u5220\u9664\u6240\u6709\u7684\u8bb0\u5f55\u5417?",function(c){if(c){c=[];for(var b=0;b<a.length;b++)c.push(a[b].id);$("#table_users").datagrid("loading");$.post("ashx/UserHandler.ashx",{action:"delete",id:c.join(",")},function(a){a=eval("("+a+")");$("#table_users").datagrid("loaded");"0"!=a.state?($("#table_users").datagrid("reload"),$.messager.show({title:"\u63d0\u793a",msg:"\u5220\u9664\u4e86"+a.msg+"\u6761\u6570\u636e"})):$.messager.show({title:"\u8b66\u544a",msg:"\u540e\u53f0\u7a0b\u5e8f\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"})})}}):$.messager.alert("\u63d0\u793a","\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u8bb0\u5f55","info")}};$("#table_users").datagrid({width:600,url:"ashx/UserHandler.ashx?action\x3dquery",title:"\u7528\u6237\u5217\u8868",iconCls:"icon-add",fitColumns:!0,columns:[[{field:"id",title:"\u7528\u6237id",sortable:!0,checkbox:!0},{field:"user_name",title:"\u7528\u6237\u540d",sortable:!0,editor:{type:"validatebox",options:{required:!0}},formatter:function(a,c,b){return a+"("+c.id+")"}},{field:"nick_name",title:"\u6635\u79f0",sortable:!0,editor:{type:"validatebox",options:{required:!0}}},{field:"reg_time",title:"\u6ce8\u518c\u65f6\u95f4",sortable:!0,width:100,editor:{type:"datebox",options:{required:!0,validType:["date"]}}}]],pagination:!0,pageSize:10,pageList:[10,20,30],pageNumber:1,sortName:"id",sortOrder:"ASC",toolbar:"#tb",onAfterEdit:function(a,c,b){"add"==global.action?(a=$("#table_users").datagrid("getChanges","inserted"),$.post("../ashx/UserHandler.ashx",{action:"add",user_name:a[0].user_name,reg_time:a[0].reg_time},function(a){"1"==a?$("#table_users").datagrid("reload"):$("#table_users").datagrid("rejectChanges")})):"update"==global.action&&(a=$("#table_users").datagrid("getChanges","updated"),$.post("../ashx/UserHandler.ashx",{action:"update",id:a[a.length-1].id,user_name:a[a.length-1].user_name,reg_time:a[a.length-1].reg_time},function(a){"1"==a?$("#table_users").datagrid("reload"):$("#table_users").datagrid("rejectChanges")}));$("#button_save,#button_cancel").hide();global.editable=void 0;global.action=""},onRowContextMenu:function(a,c,b){a.preventDefault();console.log(b)}})});
//# sourceMappingURL=38.min.js.map
